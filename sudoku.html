<!DOCTYPE HTML>
<html>
<head>
<title>Sudoku!</title>
<link rel="icon" type="image/ico" href="http://127.0.0.1/favicon.ico" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=442">
    
    <title>HTML Sudoku Board</title>
    
    
    <style type="text/css">
    
      html, body {
        background-color: #e7eefc;
        border-collapse: collapse;
        border-spacing: 0;
        padding: 0px;
        margin: 0 0 0px;
      }

      table {
        padding: 0px;
        border-collapse: collapse;
        border-spacing: 0;
      }

      td {
        border: 1px solid #000000;
        text-align: center;
        vertical-align: middle;  
        padding: 0px;
      }

      tr {
        padding: 0px;
      }

      br { 
        display: block; 
        margin-bottom: -.4em; 
      } 

      #board_name {
        padding: 0px;
        border-collapse: collapse;
        border-spacing: 0;
        font-size: 12px;
        font-family: Comic, sans;
      }
     
      button.numbutton {
        border: 0;
        line-height: 2.5;
        padding: 0 15px;
        font-size: 24px;
        width: 60px;
        height: 60px;
        text-align: center;
        color: #82bbe6;
        text-shadow: 1px 1px 1px #a4d4fa;
        border-radius: 10px;
        background-image: radial-gradient(circle at top left, rgba(255,255,255,1) 25%, rgba(150,149,172,1) 100%);
        box-shadow: inset 2px 2px 3px rgba(255, 255, 255, .6), inset -2px -2px 3px rgba(0, 0, 0, .6);
        touch-action: manipulation;
      }
      button.numbutton:hover {
        background: rgba(150,149,172,1);
      }
      button.numbutton:active {
        box-shadow: inset -2px -2px 3px rgba(255, 255, 255, .6), inset 2px 2px 3px rgba(0, 0, 0, .6);
      }

      .dpad {
        border: none;
        width: 60px;
        height: 60px;
        background: radial-gradient(circle at top left, rgba(255,255,255,1) 25%, rgba(150,149,172,1) 100%);
        touch-action: manipulation;
      }
      .dpad:hover {
        background: rgba(150,149,172,1);
      }
      .dpad:active {
        background: inset -2px -2px 3px rgba(255, 255, 255, .6), inset 2px 2px 3px rgba(0, 0, 0, .6);
      }
      .dpad-up {
        clip-path: ellipse(100% 100% at 50% 100%); /* polygon(0 25%, 50% 0, 100% 25%, 100% 100%, 0 100%); */
      }
      .dpad-left {
        clip-path: ellipse(100% 100% at 100% 50%);  /* polygon(25% 0%, 100% 0%, 100% 100%, 25% 100%, 0% 50%); */
      }
      .dpad-right {
        clip-path: ellipse(100% 100% at 0% 50%); /* polygon(0% 0%, 75% 0%, 100% 50%, 75% 100%, 0% 100%); */
      }
      .dpad-down {
        clip-path: ellipse(100% 100% at 50% 0%);   /* polygon(0% 0%, 100% 0, 100% 75%, 50% 100%, 0 75%); */
      }

      .control_panel {
        border: none;
        width: 100%;
        touch-action: manipulation;
      }
     
      p[cell=""] {
        color: #000000;
        padding: 0;
        margin: 0 0 0px;
        border: 0;
        text-align: center;
        width: 48px;
        height: 48px;
        font-size: 24px;
        background-color: #FFFFFF;
        touch-action: manipulation;
        outline: none;
      }

      p[clue_cell=""] {
        background-color: #EEEEEE;
        line-height: 48px;
      }

      #cell-0,  #cell-1,  #cell-2  { border-top:    2px solid #000000; }
      #cell-2,  #cell-11, #cell-20 { border-right:  2px solid #000000; }
      #cell-18, #cell-19, #cell-20 { border-bottom: 2px solid #000000; }
      #cell-0,  #cell-9,  #cell-18 { border-left:   2px solid #000000; }

      #cell-3,  #cell-4,  #cell-5  { border-top:    2px solid #000000; }
      #cell-5,  #cell-14, #cell-23 { border-right:  2px solid #000000; }
      #cell-21, #cell-22, #cell-23 { border-bottom: 2px solid #000000; }
      #cell-3,  #cell-12, #cell-21 { border-left:   2px solid #000000; }

      #cell-6,  #cell-7,  #cell-8  { border-top:    2px solid #000000; }
      #cell-8,  #cell-17, #cell-26 { border-right:  2px solid #000000; }
      #cell-24, #cell-25, #cell-26 { border-bottom: 2px solid #000000; }
      #cell-6,  #cell-15, #cell-24 { border-left:   2px solid #000000; }

      #cell-27, #cell-28, #cell-29 { border-top:    2px solid #000000; }
      #cell-29, #cell-38, #cell-47 { border-right:  2px solid #000000; }
      #cell-45, #cell-46, #cell-47 { border-bottom: 2px solid #000000; }
      #cell-27, #cell-36, #cell-45 { border-left:   2px solid #000000; }

      #cell-30, #cell-31, #cell-32 { border-top:    2px solid #000000; }
      #cell-32, #cell-41, #cell-50 { border-right:  2px solid #000000; }
      #cell-48, #cell-49, #cell-50 { border-bottom: 2px solid #000000; }
      #cell-30, #cell-39, #cell-48 { border-left:   2px solid #000000; }

      #cell-33, #cell-34, #cell-35 { border-top:    2px solid #000000; }
      #cell-35, #cell-44, #cell-53 { border-right:  2px solid #000000; }
      #cell-51, #cell-52, #cell-53 { border-bottom: 2px solid #000000; }
      #cell-33, #cell-42, #cell-51 { border-left:   2px solid #000000; }

      #cell-54, #cell-55, #cell-56 { border-top:    2px solid #000000; }
      #cell-56, #cell-65, #cell-74 { border-right:  2px solid #000000; }
      #cell-72, #cell-73, #cell-74 { border-bottom: 2px solid #000000; }
      #cell-54, #cell-63, #cell-72 { border-left:   2px solid #000000; }

      #cell-57, #cell-58, #cell-59 { border-top:    2px solid #000000; }
      #cell-59, #cell-68, #cell-77 { border-right:  2px solid #000000; }
      #cell-75, #cell-76, #cell-77 { border-bottom: 2px solid #000000; }
      #cell-57, #cell-66, #cell-75 { border-left:   2px solid #000000; }

      #cell-60, #cell-61, #cell-62 { border-top:    2px solid #000000; }
      #cell-62, #cell-71, #cell-80 { border-right:  2px solid #000000; }
      #cell-78, #cell-79, #cell-80 { border-bottom: 2px solid #000000; }
      #cell-60, #cell-69, #cell-78 { border-left:   2px solid #000000; }

    </style>


</head>
<body>
<div id="main"></div>
<script type="text/javascript">


class SudokuCell {
  constructor(value, idx) {
    if (value === '_') {
      value = null;
      this.impossible_values = new Set();
    } else {
        if (!all_values.has(value)) {
          throw new Error(`value: ${value} must be a single-digit string integer.`);
        }
        this.impossible_values = new Set(all_values);
        this.impossible_values.delete(value);
    }
    this.value = value;
    this.idx = idx;
    this.row = Math.ceil((idx + 1)/9);
    this.col = parseInt((idx / 9).toFixed(2).toString().split('.').slice(-1)[0][0])+1;
    this.blk = blk_lookup[this.row][this.col];
  }
  value_setter(submitted_value) {
    if (this.impossible_values.has(submitted_value)) {
      throw new Error(`${submitted_value} is listed as impossible in row: ${this.row} col: ${this.col}`);
    } else if (!all_values.has(submitted_value)) {
      throw new Error(`submitted_value: ${submitted_value} must be 1-9 (as a string)`);
    }
    this.value = submitted_value;
  }
  possible_values() {
    if (this.value === null) {
      return new Set([...all_values].filter(x => !this.impossible_values.has(x)));
    } else {
      return new Set([this.value]);
    }
  }
  ent(symbol) {
    if (symbol === sym_row) {
      return this.row;
    } else if (symbol === sym_col) {
      return this.col;
    } else if (symbol === sym_blk) {
      return this.blk;
    }
  }
}
const blk_col_1 = {1: 1, 2: 1, 3: 1, 4: 2, 5: 2, 6: 2, 7: 3, 8: 3, 9: 3}
const blk_col_2 = {1: 4, 2: 4, 3: 4, 4: 5, 5: 5, 6: 5, 7: 6, 8: 6, 9: 6}
const blk_col_3 = {1: 7, 2: 7, 3: 7, 4: 8, 5: 8, 6: 8, 7: 9, 8: 9, 9: 9}
const blk_lookup = {
  1: blk_col_1,
  2: blk_col_1,
  3: blk_col_1,
  4: blk_col_2,
  5: blk_col_2,
  6: blk_col_2,
  7: blk_col_3,
  8: blk_col_3,
  9: blk_col_3
}


class SudokuSolver {
  constructor(puzzle_str) {
    this.init(puzzle_str);
    this.cheer = document.createElement('audio');
    this.cheer.src = "crowd_cheer.mp3";
    this.cheer.preload = "auto";
    this.cheer.credit = "This audio clip is thanks to lchapman1980 of freesound.com";
    this.pity = document.createElement('audio');
    this.pity.src = "crowd_pity.mp3";
    this.pity.preload = "auto";
    this.pity.credit = "This audio clip is thanks to Adam_N of freesound.com";
  }
  init(puzzle_str) {
    this.puzzle_str = puzzle_str;
    this.puzzle = [];
    this.puzzle_by_rowcol  = {};
    this.puzzle_by_row = {};
    this.puzzle_by_col = {};
    this.puzzle_by_blk = {};
    this.puzzle_ent = new Map();
    this.puzzle_ent[sym_row] = this.puzzle_by_row;
    this.puzzle_ent[sym_col] = this.puzzle_by_col;
    this.puzzle_ent[sym_blk] = this.puzzle_by_blk;
    this.unsolved_cell_count = 0
    for (let i=0; i < this.puzzle_str.length; i++) {
      let cell = new SudokuCell(this.puzzle_str.charAt(i), i);
      this.puzzle.push(cell);
      this.puzzle_by_rowcol[`${cell.row}-${cell.col}`] = cell
      this.append_to_map_array(this.puzzle_by_row, cell, cell.row)
      this.append_to_map_array(this.puzzle_by_col, cell, cell.col)
      this.append_to_map_array(this.puzzle_by_blk, cell, cell.blk)
      if (cell.value === null) {
        this.unsolved_cell_count++
      }
    }
  }

  append_to_map_array(obj, item, item_vector) {
    if (obj.hasOwnProperty(item_vector)) {
      obj[item_vector].push(item)
    } else {
      obj[item_vector] = [item]
    }
  }

  addValueToSolver(value, cell_rowcol) {
    var solver_cell = this.puzzle_by_rowcol[cell_rowcol];
    var increment = solver_cell.value === null ? 1 : 0;
    solver_cell.value = value;
    this.unsolved_cell_count = this.unsolved_cell_count - increment;
    this.checkProgress();
  }

  removeValueFromSolver(cell_rowcol) {
    var solver_cell = this.puzzle_by_rowcol[cell_rowcol];
    var decrement = solver_cell.value === null ? 0 : 1;
    solver_cell.value = null;
    this.unsolved_cell_count = this.unsolved_cell_count + decrement;
    this.checkProgress();
  }

  checkProgress() {
    if (this.unsolved_cell_count != 0) {
      return;
    }
    if (this.boardCorrect()) {
      this.cheer.play();
      alert("Congratulations!");
    } else {
      this.pity.play();
      alert("Board Invalid.");
    }
  }

  boardCorrect() {
    var entity_type, ent, ent_vals, ent_vals_set, same
    for (let i = 0; i < 3; i++) {
      var entity_type = entities[i];
      for (let idx = 0; idx < 9; idx++) {
        var ent = this.puzzle_ent[entity_type][idx+1];
        var ent_vals = ent.map(function(cell) {
          return cell.value;
        })
        var ent_vals_set = new Set(ent_vals);
        var same = new Set([...all_values].filter(x => !ent_vals_set.has(x))).size === 0;
        if (!same) {
          return false;
        }
      }
    }
    return true;
  }
}



var cell_lookup = {};
function addTable(solver, cell_lookup) {
  var t, r, c, container, content;
  let div = document.createElement("div");
  div.id = "board_container";
  board_name = document.createElement("h");
  board_name.id = "board_name";
  board_name.textContent = "Sudoku, by Andrew Daltas";
  div.appendChild(board_name);
  t = document.createElement('table');
  div.appendChild(t);
  t.id = "grid";
  for (let i=1; i < 10; i++) {
    r = t.insertRow();
    let cells = solver.puzzle_by_row[i];
    for (let cell of solver.puzzle_by_row[i]) {
      c = r.insertCell();
      container = document.createElement("div");
      content = init_cell_content(`cell-${cell.idx}`,
                                  cell.value,
                                  `${cell.row}-${cell.col}`,
                                  cell.value || '');
      cell_lookup[content.rowcol] = content.id;
      content.onmouseover = doTheNecessary;
      container.onmousedown = intercept_click;
      container.appendChild(content);
      c.appendChild(container);
    }
  }
  return div;
}

function init_cell_content(id, clue_cell, rowcol, text_content) {
  content = document.createElement("p");
  content.setAttribute('cell','');
  content.id = id;
  content.rowcol = rowcol;
  content.style.lineHeight = "48px";
  content.textContent = text_content;
  if (clue_cell) {
    content.setAttribute('clue_cell','');
  }
  return content;
}

function intercept_click(event) {
  if (event.target.id.includes('cell-')) {
    doTheNecessary(event.target.id);
  }
}

document.addEventListener('keydown', intercept_keydowns);
const integer_keys = ['1','2','3','4','5','6','7','8','9'];
function intercept_keydowns(event) {
  let current_editable = !current_cell.hasAttribute('clue_cell');
  if (event.which === 8) {
    event.preventDefault();
    if (current_editable) {
      eraseCellContent();
    }
  } else if (current_editable && integer_keys.includes(event.key)) {
    current_cell.value = event.key;
    editCell(event.key);
  } else if (directional_keys.includes(event.keyCode)) {
    change_current_cell(event.keyCode);
  }
}

const SOLVE        = Symbol('SOLVE');
const ERASER       = Symbol('ERASER');
const PENCIL       = Symbol('PENCIL');

const PENCIL_RED   = Symbol('PENCIL_RED');
const PENCIL_BLUE  = Symbol('PENCIL_BLUE');
const PENCIL_GREEN = Symbol('PENCIL_GREEN');
const PENCIL_BLACK = Symbol('PENCIL_BLACK');
const color_lookup = {};
color_lookup[PENCIL_RED]   = 'red';
color_lookup[PENCIL_BLUE]  = 'blue';
color_lookup[PENCIL_GREEN] = 'green';
color_lookup[PENCIL_BLACK] = 'black';

var mode = SOLVE;
var pencil_color = PENCIL_BLACK;

function editCell(solution) {
  if (mode === SOLVE) {
    let rowcol = current_cell.rowcol;
    let p = init_cell_content(current_cell.id, 
                              current_cell.hasAttribute('clue_cell'),
                              rowcol,
                              solution);
    current_cell.outerHTML = p.outerHTML;
    current_cell = document.getElementById(current_cell.id);
    current_cell.rowcol = rowcol;
    setCurrentCellStyle();
    solver.addValueToSolver(solution, rowcol);
  } else if (mode === PENCIL) {
    editPencilCell(parseInt(solution));
  }
}

function eraseCellContent() {
  if (current_cell.hasAttribute('clue_cell')) {
    return;
  }

  let rowcol = current_cell.rowcol;
  let p = init_cell_content(current_cell.id, 
                            current_cell.hasAttribute('clue_cell'),
                            current_cell.rowcol,
                            '');
  current_cell.outerHTML = p.outerHTML;
  current_cell = document.getElementById(current_cell.id);
  current_cell.rowcol = rowcol;
  setCurrentCellStyle()
  solver.removeValueFromSolver(rowcol);
}

const sym_up    = Symbol('UP');
const sym_down  = Symbol('DOWN');
const sym_left  = Symbol('LEFT');
const sym_right = Symbol('RIGHT');
const directional_keys = [39,68,38,87,37,65,40,83];
function change_current_cell(event_keycode) {
  if (event_keycode===39 || event_keycode===68) {
    var direction = sym_right;
  } else if (event_keycode===37 || event_keycode===65) {
    var direction = sym_left;
  } else if (event_keycode===38 || event_keycode===87) {
    var direction = sym_up;
  } else if (event_keycode===40 || event_keycode===83) {
    var direction = sym_down;
  }

  let s = current_cell.rowcol.split('-');
  var r = s[0];
  var c = s[1];
  if ([sym_left, sym_up].includes(direction)) {
    var increment = -1;
  } else {
    var increment =  1;
  }
  if ([sym_left, sym_right].includes(direction)) {
    var seeking = parseInt(c) + increment;
    seeking = hitWallTeleport(seeking);
    var next_rowcol = `${r}-${seeking}`;
  } else {
    var seeking = parseInt(r) + increment;
    seeking = hitWallTeleport(seeking);
    var next_rowcol = `${seeking}-${c}`;
  }
  if (1 > seeking || seeking > 9) {return;}
  var next_id = cell_lookup[next_rowcol];

  doTheNecessary(next_id);
}

function hitWallTeleport(seeking) {
  if (1 > seeking) {
    seeking = 9;
  } else if (seeking > 9) {
    seeking = 1;
  }
  return seeking;
}

function doTheNecessary(cell_or_event) {
  setCellStyleNotCurrent();
  function_input_type = cell_or_event.constructor.toString().match(/function (.*)\(/)[1];
  if (function_input_type === "MouseEvent") {
    cell_id = cell_or_event.target.id;
  } else {
    cell_id = cell_or_event;
  }
  current_cell = document.getElementById(cell_id);
  setCurrentCellStyle();
}

function setCellStyleNotCurrent() {
  if (current_cell.hasAttribute('clue_cell')) {
    current_cell.style.backgroundColor = '#EEEEEE';
  } else {
    current_cell.style.backgroundColor = '#FFFFFF';
  }
}

function setCurrentCellStyle() {
  if (current_cell.hasAttribute('clue_cell')) {
    current_cell.style.backgroundColor = '#fcff9d'; 
  } else {
    current_cell.style.backgroundColor = '#ABCDEF';
  }
}


function createDirectionalPad() {
  var d, t, r, c, b;
  d = document.createElement("div");
  d.id = "directional_pad";
  t = document.createElement('table');
  d.appendChild(t);
  t.id = "padme";
  t.style.border = "0";
  for (let i=1; i < 10; i++) {
    if (i % 3 === 1) {
      var r = t.insertRow();
    }
    let c = r.insertCell();
    c.style.border = "0";
    if (i % 2 != 0) {
      continue;
    }

    let b = document.createElement('button');
    b.onmousedown = sendSignal;
    if (i === 2) {
      addButtonAttributes(b, "dpad dpad-up", "38", "up-arrow.svg");
    } else if (i === 4) {
      addButtonAttributes(b, "dpad dpad-left", "37", "left-arrow.svg");
    } else if (i === 6) {
      addButtonAttributes(b, "dpad dpad-right", "39", "right-arrow.svg");
    } else if (i === 8) {
      addButtonAttributes(b, "dpad dpad-down", "40", "down-arrow.svg");
    }
    c.appendChild(b);
  }
  return d;
}

function addButtonAttributes(button, class_name, direction, svg_file_path) {
  button.className = class_name;
  button.direction = direction;
  let svg = document.createElement('img');
  svg.src = svg_file_path;
  button.appendChild(svg);
}

function sendSignal(e) {
  change_current_cell(parseInt(e.target.parentElement.direction));
  e.target.blur();
}

function createDialPad() {
  var d, t, r, c, b;
  d = document.createElement("div");
  d.id = "dial_pad";
  t = document.createElement('table');
  d.appendChild(t);
  t.id = "dial_pad_table";
  t.style.border = "0";
  for (let i=1; i < 10; i++) {
    if (i % 3 === 1) {
      var r = t.insertRow();
    }
    let c = r.insertCell();
    c.style.border = "0";

    let b = document.createElement('button');
    b.className = "numbutton";
    b.onmousedown = signalDialPad;
    b.textContent = i.toString();
    c.appendChild(b);
  }
  return d;
}

function signalDialPad(e) {
  if (mode === SOLVE && integer_keys.includes(e.target.textContent) && !current_cell.hasAttribute('clue_cell')) {
    editCell(e.target.textContent);
  } else if (mode === PENCIL) {
    editPencilCell(parseInt(e.target.textContent));
  } 
}

function createEraseButton() {
  let div = document.createElement('div');
  div.style.display = "inline-block";
  let eraser_button = document.createElement('button');
  eraser_button.className = "numbutton";
  eraser_button.textContent = ""
  let svg = document.createElement('img');
  svg.src = "eraser.svg";
  eraser_button.appendChild(svg);
  eraser_button.onclick = eraseCellContent;
  div.appendChild(eraser_button);
  return div;
}


function editPencilCell(digit) {
  var pencil_content, span;
  var color = color_lookup[pencil_color];
  if (!current_cell.hasAttribute('pencil_content')) {

    if (solver.puzzle_by_rowcol[current_cell.rowcol].value) {
      solver.removeValueFromSolver(cell_rowcol);
    }

    var pencil_content = createPencilContent();
    span = retrieveSpanToEdit(pencil_content, digit)
    span.style.color = color;
    span.textContent = `${digit.toString()} `;
    current_cell.innerHTML = pencil_content.innerHTML;
    current_cell.style.fontSize = "14px";
    current_cell.style.lineHeight = "19px";
    current_cell.setAttribute('pencil_content','');
    current_cell.style.whiteSpace = "pre";
  } else {
    var pencil_content = current_cell;
    span = retrieveSpanToEdit(pencil_content, digit);
    span.textContent = `${digit.toString()} `;
    span.style.color = color;
  }
}

function retrieveSpanToEdit(pencil_content, digit) {
  var span;
  if (digit < 4) {
    span = pencil_content.children[digit-1];
  } else if (4 <= digit && digit <= 6) {
    span = pencil_content.children[digit];
  } else {
    span = pencil_content.children[digit+1];
  }
  return span;
}

function createPencilContent() {
  pencil_content = document.createElement('p');
  pencil_content.id = "pencil_content";
  for (let i=0; i < 11; i++) {
    if (i === 3 || i === 7) {
      pencil_content.appendChild(document.createElement('br'));
      continue;
    }
    let s = document.createElement('span');
    s.textContent = "  ";
    s.style.fontFamily = "Consolas";
    pencil_content.appendChild(s);
  }
  return pencil_content;
}


function createMenuSelect() {
  let div = document.createElement('div');

  let select = document.createElement('select');
  select.id = "menu_selector";
  select.onchange = loadNewPuzzle;

  let option1 = document.createElement('option');
  let option2 = document.createElement('option');
  let option3 = document.createElement('option');
  let option4 = document.createElement('option');
  let option5 = document.createElement('option');

  option1.textContent = "--New Game--";
  option2.textContent = "Easy";
  option3.textContent = "Medium";
  option4.textContent = "Hard";
  option5.textContent = "Expert";
  option2.value = "easy";
  option3.value = "medium";
  option4.value = "hard";
  option5.value = "expert";
  select.appendChild(option1);
  select.appendChild(option2);
  select.appendChild(option3);
  select.appendChild(option4);
  select.appendChild(option5);
  div.appendChild(select);
  return div;
}

function loadNewPuzzle(event) {
  if (event.target.value === "easy") {
    difficulty = EASY;
  }
  else if (event.target.value === "medium") {
    difficulty = MEDIUM;
  }
  else if (event.target.value === "hard") {
    difficulty = HARD;
  }
  else if (event.target.value === "expert") {
    difficulty = EXPERT;
  }
  event.target.selectedIndex = 0;
  event.target.blur();

  var puzzle_str = randomPuzzle(difficulty);
  solver.init(puzzle_str);

  for (let i=0; i < solver.puzzle.length; i++) {
    solver_cell = solver.puzzle[i];
    cell_element = document.getElementById(`cell-${i}`);
    
    cell_element.removeAttribute('pencil_content');
    if (cell_element.hasAttribute('clue_cell')) {
      if (solver_cell.value) {
        cell_element.innerText = solver_cell.value;
      } else {
        cell_element.removeAttribute('clue_cell');
        cell_element.innerText = "";
        cell_element.style.backgroundColor = "#FFFFFF";
      }
    } else if (solver_cell.value) {
      cell_element.setAttribute('clue_cell','');
      cell_element.innerText = solver_cell.value;
      cell_element.style.backgroundColor = "#EEEEEE";
    } else {
      cell_element.style.fontSize = "24px";
      cell_element.style.fontFamily = "";
      cell_element.style.lineHeight = "48px";
      cell_element.innerText = "";
    }
  }
  setCurrentCellStyle();
}

const easy_puzzles = [
  "_8__7_54_3___2______48_61__5____9__76_____25__2___3____1_7__8_______2__________34",
  "_1____5_2____5__4_6_3_8___7___2_____4__6__8_______8_937__16___5__2____8_________4",
  "__5____4____1_52_83_4_______41___7__________153_6_7_____3__96___9_28_4___6__5___9",
  "______5_______62_39_________8__3__1___75_1__6_4_8___2_1____7___8__61__7___53___4_",
  "___8___49___4_2________16________2__93__84___1___2__36___7_8__434____1___9____5__",
  "___2_9__7_____89___62_3_________1_9_8__52____1_79________1_5_7__4______5____7_316",
  "7__________5_69_____91__7_43___52_8__7_8__6______4___2____1_84686______5_________",
  "____8________753__479____2___7_9_1____8_____9_1___38_______2____8_4_6__11_____24_",
  "4__2__1___86____4___23__8___381__________45___9_____87___42_________13_23______5_",
  "_3__________9_28__4_136_9___17_5_2_8________55_41___3___5___78_________2__9_1____",
  "_2____8_____2_4_7_43_71________5__2___6_715____1_____9_9__8_____8_4_5___5_____1__",
  "_1_____74__6_5_3___7_3_9___4__2_8_5968_7___________4_88_2__5_____7_____1_________",
  "_1_______23561______6_____2______8____254_____5__76_1______4__98___3_____7___12__",
  "____2_________8__9_1___7_56_9_1__74___1___9___38_75________43___63_____18___6____",
  "_____71___6__4____13___2____8_65_____21__8_____5___________42_19__3___57_168___9_",
  "_3_____75____7___65_68_______14__8__7___6_1______1_42_______5__4__3_____6__589_1_",
  "_________7_3_9_5_6__6____19_2_86__5____2__14__37____2__5_9__2__1________97___13__",
  "__65_2_8__2_4_3_________4__4__3___1______1__28____7_5________981___5_3__28___4__5",
  "7_1_2_8_____647_____9______9______8__3__76___46_2_3____2___4______85_2_________75",
  "8___42_9________23__5_6_________7_8_34__95__2_5____74__74___________9_____3_2_85_",
  "38____6_5_____1_9_9__82____13__9____8___42___6__3__14_______4672_7______________9",
  "______5___9__5_1___6_421_____68___7_7_________8___5_62_____7__54_268_3__3________",
  "4_______9____174_____6_432___67____8__2___67___9_8__4_____3_2__6_38__________9___",
  "__26_____________5__1_52___147_9_____3____9_______53___64__3__1_95_4_2_33____6___",
  "_7__8___41___4_____5___7__8______1374_1__3_6__2_9__4_____2__6___13__82__6________",
  "__93__________4___1_425_6_9_7_____32__6_7_____2__3__8________6____5__9__5_84_____",
  "__4_56_9__8______6_7_____4_______91__5_82__7__46__9______5__7__4_23_1__________2_",
  "_____2_46__2____1____869__2_9_3_7___43_6__1________7_4_____12_8_________36__8____",
  "__74_6______3_21__3_______69_5_2___4_____1__24____3____8______3_53__72_8________9",
  "___93_7__91___643__42__7________5__6____1__2___6_____9_543_9___________4_2__8_6__",
  "_______1_____32_____7_9_62_96_5__8_78___7__3___1______24___________2_1__1__8___93",
  "_8_5_______1__8__4______2___6_8____259____8___7__9_6_____1___65__9__4__3__3___7__",
  "________7_2__1__4_____74_______81__5_6_435____1____9___82_4___1__7___39_9____7_5_",
  "___5_1_______2_8___1__48___75___4_______6__4_62___3_853_9_7__5___1____375_2_____6",
  "___1____7__1__5__99_____1______4__6_62_7___4__1_5_____2__38_____7__6_43___4______",
  "5_4___61________7____4_9__8__13______5_7____6_432__5___3___6___69___7__1__7_2____",
  "6____8_359___4_6__2_8________3___9____2___178_59____6______4______283__4____9____",
  "4__27__1___91____6___5_6_______8_5_46___4__92_______8_24______5__7_6_______9____1",
  "_72___3____3_1_______7___4__3756_1__2__1_____8____42_________8___197___2______5__",
  "______34__7___9_582_9__4_____69________32__6_______1_____6_____4______879_2_41___",
  "9__81_4____5______2______93__418__3_____7___8_1_9_____37_______5_6_38__7_____6_4_",
  "6___29_____35_____7__4__9___6____4_58_______9__5_1_37__________14__6_2___39_5_1__",
  "9_3_2_4__18_9____7_____5_6__5_____23_______1_8_______4_9_7________8_2___4___1_9__",
  "____179_6__2________89___43___3_6_7___7___15______2____7159____82_______5________",
  "_____5___16___7_____2__46___9____2____64___5___81__3__759__1_28_____8__3________5",
  "_______14__79_________81____4___698__8_____3_9_5__8__643_7_______6_5__97____623__",
  "___34__7___2_______5__86____6___2__7__3_5_6________84____1___3_6_____4_994______5",
  "5_9____7_______8____2_376_9_235__7_______9____51_8_2___3_______1____5_4__857_____",
  "_185_____3__7__89_2__4___________68___7_6______23_45__5_46_32___________673_1____",
  "7_49_1____3__2___4__8__3_6___3_7__5__8___2_3__1______9__923_5__4__7_82___________"
];

const medium_puzzles = [
  "_5_4_9_____43____1____2___8_9___86__2______8__61__7___34_________9__6__7_______62",
  "3____1_4____34_5____2__87_____9_7_1_13__5__2___7_2___6_1____95_4__2_______8______",
  "_2____81____317___5_______________________5_685_62_7____4__5__3_7_264________1_8_",
  "______394__4_6_8_7_____31____3____4____2____9_6__7______7__9_2__38_______2___8__6",
  "9____2____715_______3_8__9_798_4__1____6____8______2___4____6__1____6_35__9_3____",
  "__6_____3____8_71_3__6_789__2__14__95__7_________3___8_39_7______5______18__2___7",
  "_69_____8__594_____4__8________3____43_6_7___58____6__2_78__3_6____52_7_______1__",
  "_73_____8______31___5_4________9_8__5___2_1___6____7_561_3____7__9_6____4____7___",
  "1_____27___26__4__5_6_9______7_6_5_2___5__1__6___3_7__3_1__4___4_9_2_____5_____4_",
  "_97__6__24_5___________25__1_28___7_8_______1_73___62_7____14_6________7__6_4_19_",
  "_5___1_971___9_5_____4__2___9_1_4___5_2_____8___83____84___91_2__________37_____6",
  "_3__4_____2___16__8_1_6______6__9_2___9_2__1____41_5_9___7__8_4_7__5___1__3_____7",
  "_9__31__8__59_______2_8_7__2_6_________3_8__1_3_6______89__35_4____5_67__________",
  "2_______1__4__53_7_3__________52_______1_9____9__3__189__2______7_8____3_8_6_3_5_",
  "_9___7__3____9_2__153____79465______9__14_____8______6___8_46_16_____________9_4_",
  "_7____54_____87______3_5___________1____3__9_5492__7____6__1___1246__9_____7___5_",
  "3_4___5___9__3_____2___4_1_71_5__8____3____4_6_9___2_____8____1___97_3______1__8_",
  "____3___267____9_8___19_36__61____3_8_______7_4___5______812__________26_5____8__",
  "__5387__1___5_____3_816_4__________29___7_6___3____7____3__61____4_98___82_______",
  "_3__28__________529__36_________6_73___49_6____7___98_5__18____8____3_4_6______9_",
  "_2_3__7_49__6_5__8__6_____________3_641_7____2___8_9___8____5__________3____2____",
  "_____5_98_7_______8_1___43____71_2___8_____74__4_____6_28_9__________14___5_3____",
  "__27__41__6_____2_____53_______36___6_____74______45_3_8__9___771_3_56___2_____3_",
  "_7___8_____1___893________15___2_____874__3__34____95__6___4____5__8_____9_16__4_",
  "7____3___________4______8163__8___5_1____6__3__7___9_______1___6_85_97___3__4___5",
  "______4__3____4__2_8____69___524____1_9__38_____6___5_______5___1_82____4_3_65___",
  "___2___533______6__1_4_______53___76782__1_________8_1_9_53_____6__98___________8",
  "____4___39__7_6____7__9____3_52__7___62___8___1______6__1__7___5_7__312__2_1___9_",
  "___39___6__6___59______8__338___________2_____15____48_97__4_6_6______79_____9__5",
  "_8______6____41_8_6____23_7_3_7_____92__385__4__________6____7_2_9___8_____217___",
  "_81_____2__________2_7__685_____72__4__913_____5___14_1__68_____9___25_1_______3_",
  "1___6______4____9__3__8_________59833_9____7_____4___16_7_3____9_82__1_____8__4__",
  "__5____8___64__2______1__9___3__97__2__6__4___8_______6__3___1__7___2_6_9__1_5___",
  "3_5_______1___79_2_2__4____4_2____1_____9__5__3__1_______8_37_______4__6_6__7_28_",
  "3_684__9________4__593______________5____31_77_4_95__8______51___3__7___8______76",
  "___7_3_2_______4___7__1_____67_32_1__4_6____29________6____85__1___9______816_9__",
  "__3_________716___67_9___8___2___1_____1__9__4_6__85_3__5_____6_____42_____57____",
  "4_2__________5__79_8_1___4_3__51_____1_6_9_________6_485___73__6_______8________2",
  "19_3_______7__________18_5_____6_38_2________34_9____5__8____71532_____9___8__5__",
  "_3___2_____6_59______37__1591______3_549_____2__1____6______9_4____2__8____5_4_2_",
  "______67_5_4_____3_37_____4_6_8_4___9__2__7_____6_____7_8__39_2_______3______1_5_",
  "____4_________15_3_9____1____6___42_2___1__9___3__8__5__7___9_4_6__37___1__6_____",
  "____8___92__6__7___31_____________5_7___1_8_4___8_6_1_36_14_________7__517____6__",
  "_18_2_5_____35__4____1_47___95_6____7____5___86_7_______9__1___1_6____24_8__4_9__",
  "___9_15___7___43_8_2_____6___4_____53___76841___5_9____4____78_981______________6",
  "__1____43_________45_9__8_7_6__8_____84__5_3_7__4______4_____2____76_4_9__85_1___",
  "_7_6____5__84____965_1___8___3_62____6____5____9___8__1__7_________5__3__8__4_2__",
  "________11_______2__8_3__6__4_________2___71_5_62____39____5________6_8_6_3_82_57",
  "6___1_9______5__2____3_9__7__184_________31__97__65___48__3_2___2__8__16_______4_",
  "_76_8__35_53__26__9________5___2__8____7__1____2__1__4_____4_13_____59___3__9____"
];

const hard_puzzles = [
  "__3____54____9___8_24___1___1_3_6__________2_4__2_8__5_798_4___3_____5_____1___8_",
  "__2__4_1____579_________58___3_2_9_69____57_1_______5_2__________8_31____7____8__",
  "___7____1_8__4__5_12___9__6___2___1_____1_9____83____________65_____7_344_5__6___",
  "1978_5______4_____45_3___1__8____4_9____8_1_72____6______62___5__6______5____1___",
  "_6__9_8__8______9________6__7______3_9__42____4_3_51____36_______2___4_____71_5__",
  "__63____584____9___72___3__4____15_____9_3_1___9______2__6_4_87_____8________24__",
  "___6_43________85_____72___________63_82______1__35______49_6___7_______85____4__",
  "_5_______2______6_36__9__8_________15_18_7__2______8___2__49__6_3_5__1__________7",
  "__6_2_______7__5__5____9_______4___1_5_3____8_37__1_____58____7___4___6_2___9_3_4",
  "____52______3_82________738__1_______476____9_6__95_8_9____1_________4___2____61_",
  "____17_5____45__71______8__9_7____6__6__8_2_____3__4___91__67____3_4___6_5_____4_",
  "____83__6___6__19_2__9______7_49_________7___4_9_5____9______5_56__4_3____3__86__",
  "____5___3_____2_1_4_81___7__7_6_1__46__2______4_____3_3____716_5_7__9___82_3_____",
  "_6_29_3_5___7________3__61_2_3___46__7___9_____1_4_____3__7____5______27___1__8_3",
  "43___6___9____83______1________7_5____46_2_____215_9__2______6_7_____159________7",
  "4___89__65____1_____7_______3____7_5____2___9__96__1___51__38______1__2_8__4_____",
  "72_9__4__9__7__35__54______27__9____8__6____3____8__1_4_2_____6____4_1_____86___7",
  "9__________72__58_32_58____2___5_____8_____97______6___1_4__7__4___3_2____3__6__1",
  "_4________5_9___4___8_63_1_3___15_7_6_5_______9_8________6__75______9__2__7_3____",
  "______89_82______146__1________7____2___39__6__75__31________6___5_4____19___2_5_",
  "_617______9___543___________4___98__1____7____78__15_9______2____4____5_2___3___6",
  "_8_1___467__2___8___9____7____3_56__________267_8___3_537__1_____675____1___2____",
  "______679_____1_4_____8___3_8_5____7__21__9__63______28_7_______2__95_3__5_8_4___",
  "__6__24____9_3__6_37___1_9__1_3__8__8__2____57_______6___4_9___2_____1_____5____7",
  "2______6___78_2_5__1__9______4_1__2_87_5_6________46__1____79__3______72__84_____",
  "_7_1_2_9_29_5_________8_7____7____1____3_1_____569__8_8_____9____4_391__1_____6__",
  "___3851____9_______3___47___654____72____9______8____3_1____2_8____7____69_25____",
  "9_61__5___________1___72_____8_3___7___6__1__7_9___2__4____98_1___54__9______1___",
  "_4___27___3______685_1___4____4____85_____2_____8_6_3_3__________931_5___7_____1_",
  "____58_____84_1____2_____4_____6___9____7__8__19_______8___74____56__3_17____386_",
  "_2_8_______3_2___84_____5_21______5____9____6_6_78___3_9_47____3_4___7__5___3__4_",
  "_7_3_____8_______9_____768__2_____3___8_6_______7_42_____5__1__51__9____432___5__",
  "__9__5__116___2__73__4_6__87____3_1__4__6_______2____46__7__2____3____75_9_______",
  "1_3_4_6_______1__2___3___9__1_7_______8_6___57____4___4_______95___8_____6723_4__",
  "382__________________726__5__96__7_2____9_6_____8__1___56_____1__7__5__4___14____",
  "________26____39_1__1_4__8__7__9_3___________39___2___24__19___7__3___________7_8",
  "__6___5____8_____7_9__5_18____2___6___9_______2_746_3__47_9___1______2_______78__",
  "_3__2_1_4___5___79_____8______9____2_46_5_7_39___4______96_5___1__________72__3__",
  "__1_56___7___9_6_8_____4____8_____7_______5___6___7_3_83574_9__________3____6__52",
  "_1_6________5_71____5____94___4__6_______8___9__1_657_1_4________382____5____47__",
  "_4___________49_2___83__1__5__1__9___19__7__6________7_6198___________4_3___6___8",
  "5___2498___2__5____9_____522____846___9_1________9_8_____1_____6____7__4__43_____",
  "___2_________7_265__6__5__4_87__4_5____________5_3_98_1_8__2__3_5_14____6__5___2_",
  "_4______53_____7_____19__2__9___1___2___8___7____364_8_6___93_2_1_______4___7____",
  "_______9___5_9_____8__61_______8_9____9_13__62_194___8_5___7_____8___361______4__",
  "____685_____19_7_______7_2_1_4____6__2__5___7__89_6___6_1_8___4______81____5_____",
  "__45_7___2____9_6__3___2__43_7________5___64_____1_9___2___4__7_1__________6___9_",
  "6_4_______3_____657_9_1__3_9______83___94_____2______7__73_4__2391_52________8___",
  "___74______2___9__54___1__8__8__9__6_____7____5_8___3_71____4________8_5_265_____",
  "2__4__8___95___3________2______8___58_32_1_______6___29_81_7________6__91________"
];

const expert_puzzles = [
  "______9______1__5___473_8__75___2_____9_87__6__8_____9_6_____1_8___7_62___53_____",
  "7________6____34_5_9____62_9_5_____8__4_9___2_3_5___4______7_____78_5_______2__14",
  "8___5_____2_______3_9____17__5__48___8___3__2______1_95____86_3___76_______3_____",
  "8___5____1_9_4_5__3__6__8____1____5__9____73_____24__9___1__3___6__75_2______2__7",
  "54___68_____1____________346_____2_______1_8_27__9___546__5_9___8______7__34_____",
  "__89___2_5___3_________78_1__2_8___7__32____6______18_____95_1___4_7_____6_4_____",
  "__1_4__6___9______4__5___3_9___2_35_3__9_1____27_____9_7_25_________76_____8___45",
  "6___1____8___4_163____8_4__1_7____9_5_3_7__2______5_________8_______1____8__6__42",
  "___3_________96__18_3_1_6_41_2___5_____25___7__9_6__1___7___2___2_______9__8___56",
  "__7___563_2___________9_____61___________62____54__78____784__1__65__8_2_______4_",
  "_9______58__6___74_7__3_8_6__27__5_86__542__7__7__3_____4__________95___3____8___",
  "7_____2_4_6_9___5_4__17__9_158____6____6__4______5___7___36______2__________9157_",
  "_6__7__4_1___8___2___4___1______9_____584_3__69_3____7_8_____6___9___2______5__74",
  "_3_4____754__9______7___18____7_62__6__2___3_8___3_________5__2__9__4_1__5__7_4__",
  "56___8__2__8_6_5____9_4______5__746__3___58__1_______________3482__16____________",
  "___6___1___1____29__2_7_3____43_6_____9___5_78______6442__5_______9_______7_63___",
  "___9__6_1__6__3_8__4_____3___2__13___8__7____5______92__378_5_________1_92___6___",
  "____6____8____4_____25__39__2___195_9___7__________23_7___9_64____7____3___3__5__",
  "_94__3______91____13____2___4_73_6____8____1____4__5__2_3__61___6_____4_____2____",
  "___1_________2___71_6_79_3___4__15__3_5_____6__15__32_____9__6__7_______5_38_____",
  "_7_1__________6__3__9____54___6___85___82__4__173_______25_9_6___6__2____9_______",
  "_1______6___2_____5__61_93_72____________9_4_______8_51___4_5__9_8__7__3_7_1_____",
  "_______7__1_9_4__8__9________5__17____3__96__1___67__9________4_82_46___3___8____"
];

const EASY   = Symbol('EASY');
const MEDIUM = Symbol('MEDIUM');
const HARD   = Symbol('HARD');
const EXPERT = Symbol('EXPERT');

const all_puzzles = new Map();
all_puzzles[EASY]   = easy_puzzles;
all_puzzles[MEDIUM] = medium_puzzles;
all_puzzles[HARD]   = hard_puzzles;
all_puzzles[EXPERT] = expert_puzzles;

var last_played = null;

function randomPuzzle(difficulty) {
  var puzzles = [...all_puzzles[difficulty]];
  var index = puzzles.indexOf(last_played);
  if (index > -1) {
    puzzles.splice(index, 1);
  }
  let min = 0;
  let max = puzzles.length;
  let random_int = Math.floor(Math.random() * (max - min) + min);
  last_played = puzzles[random_int];
  return last_played;
}


const sym_row = Symbol('row')
const sym_col = Symbol('column');
const sym_blk = Symbol('block');
const entities = [sym_row, sym_col, sym_blk];
const all_values = new Set(['1','2','3','4','5','6','7','8','9']);

var difficulty = EASY;
var puzzle_str = randomPuzzle(difficulty)
let solver = new SudokuSolver(puzzle_str);

var board = addTable(solver, cell_lookup);
const dial_pad = createDialPad();
const directional_pad = createDirectionalPad();
const eraser_button = createEraseButton();

const div = document.createElement('div');
div.appendChild(board);
const t = document.createElement('table');
t.id = "control_panel";
t.style.display = "flex";
div.style.display = "inline-block";
let r = t.insertRow();
let c1 = r.insertCell();
let c3 = r.insertCell();
c1.className = "control_panel dial";
c3.className = "control_panel direction";
c1.appendChild(dial_pad);
c3.appendChild(directional_pad);
div.appendChild(t);
dial_pad.children[0].children[0].children[1].appendChild(eraser_button)
document.body.appendChild(div);

const menu_select = createMenuSelect();
document.body.appendChild(menu_select);

var current_cell = document.getElementById('cell-0');
setCurrentCellStyle();

</script>
</body>
</html>
